<!doctype html>
<html lang="en" class="no-js">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	
	<title>Nathan McGinness</title>
	<meta name="description" content="">
	<meta name="author" content="">
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<link rel="stylesheet" href="stylesheets/compiled/base.css?v=2">
	
	<script type="text/javascript" src="http://use.typekit.com/atw0rqs.js"></script>
  <script type="text/javascript">try{Typekit.load();}catch(e){}</script>

</head>
<body>
	<div id="container" class="container_24">
	  <div class="grid_24">
  		<header>
        <h1>Nathan McGinness</h1>
  		</header>
  		<div id="sidebar" class="grid_5">
  		  <div id="fixed" class="grid_5">
      		<nav id="main-nav">
      		  <ul>
    		      <li><a href="#">Blog</a></li>
    		      <li><a href="#">About</a></li>
    		      <li><a href="#">Work</a></li>
    		      <li><a href="#">Contact</a></li>
      		  </ul>    		  
      		</nav>
      		<p>I love design, interaction, pixels, grids, data, type &amp; language. I get to play with all these things at Topguest where I&rsquo;m the lead UX designer.</p>
      		<nav id="elsewhere">
      		  <ul>
    		      <li><a href="http://www.linkedin.com/pub/nathan-mcginness/3/b2a/800">Linkedin</a></li>
    		      <li><a href="http://www.last.fm/user/njmcgee">Last.fm</a></li>
    		      <li><a href="https://twitter.com/#!/njmcgee">Twitter</a></li>
    		      <li><a href="http://www.flickr.com/photos/njmcgee/">Flickr</a></li>
    		      <li><a href="http://www.delicious.com/njmcgee">Delicious</a></li>
    		      <li><a href="https://github.com/njmcgee">Github</a></li>
    		      <li><a href="http://njmcgee.tumblr.com">Tumblr</a></li>
    		      <li><a href="http://dribbble.com/njmcgee">Dribble</a></li>
      		  </ul>    		  
      		</nav>
    		</div>
    	</div>
		  <div id="main" role="main" class="grid_17">
		    <article id="post">
  <div class="meta-data grid_2 alpha">
    <a class="image-link" href="http://www.linkedin.com/in/timols"><img class="author" src="/images/tim-olshansky.jpg" alt="Tim Olshansky" /></a>            
    <div class="clear"></div>            
    <a class="author-link" href="http://www.linkedin.com/in/timols">Tim Olshansky</a>
    <span class="date">22 March 2011</span>
  </div>
  <div class="grid_8 omega prepend_2 post-body">
    <h1>Integrating the Instagram <span class="caps">API</span> with Rails 2.3.5</h1>
<p>Recently Instagram launched their <span class="caps">API</span> allowing application developers to access their users&#8217; photos and the locations associated with those photos. Obviously we saw this as an interesting opportunity to integrate a very popular photo sharing service with Topguest, and couldn&#8217;t resist giving users another way to receive rewards from their favorite loyalty programs.</p>
<p>This has since generated a lot of media buzz and interest, as well as having resulted in a significant increase in our web traffic. We&#8217;re very happy with the results and want to share with you the story of how we did it, and what we learned along the way. The integration was not easy, but thankfully we managed to roll it out fairly quickly despite some of the obstacles that were in our path.</p>
<p>A number of technical details follow from this point, so if you&#8217;re not interested in the technical side of things, feel free to skip the next few paragraphs.</p>
<p>A few technical details about Topguest: it&#8217;s written in Ruby, using Ruby on Rails v2.3.5, has a PostgreSQL database and is all deployed with Amazon Web Services. We&#8217;ve integrated all sorts of other services into Topguest (even Dropbox!) but those are the most important.</p>
<p>Now Instagram has its own <a href="https://github.com/Instagram/instagram-ruby-gem">ruby gem</a> which is still a work in progress. At the time of our decision to integrate it was missing real-time functionality and had a number of dependencies which were incompatible with Rails 2. As a result, I had roll up my sleeves and write my own wrapper for the <span class="caps">API</span>.</p>
<p>The biggest thorn in our foot was the dependency on <a href="http://rubygems.org/gems/faraday">faraday</a> version 0.5.4 which is completely incompatible with versions of Rails earlier than 3. When we installed the gem, faraday caused Topguest to explode on my development machine costing me precious time as I had to weed out the culprit gem. For those that are considering using this gem, faraday versions &gt; 0.4.6 will not work with Rails 2, so ensure your application is built in Rails 3.</p>
<p>Another signifcant splinter was the missing real-time functionality in the gem. Real-time functionality via the <a href="http://en.wikipedia.org/wiki/PubSubHubbub">pubsubhubbub</a> protocol is becoming common amongst APIs. We use it with Facebook, Instagram and Gowalla to allow our users&#8217; checkins to be rewarded almost immediately instead of relying on polling tasks. Polling frequently doesn&#8217;t scale well and was already giving us trouble, so we were very happy to see the protocol included in Instagram&#8217;s <span class="caps">API</span>. Now we&#8217;re waiting for Twitter and Foursquare to implement it.</p>
<p>The remaining issue was the fact that the Instagram gem had a great deal of functionality that we just plain didn&#8217;t need. We were only really interested in a handful of endpoints, such as authentication, user info (for emails) and user media (photos). The additional <span class="caps">CUD</span> (dropping the R in <a href="http://en.wikipedia.org/wiki/Create,_read,_update_and_delete"><span class="caps">CRUD</span></a>) was unnecessary as all we really need to watch out for are photos that are tagged with a location. We don&#8217;t publish anything in a user&#8217;s stream (and in any case, the <span class="caps">API</span> doesn&#8217;t support it currently).</p>
<p>Given our requirements, I then set about writing a simple wrapper for the <span class="caps">API</span> using only Net::<span class="caps">HTTP</span>, <span class="caps">URI</span> and <span class="caps">JSON</span> modules that are all part of the ruby v1.8.7 standard library. I began with the most important endpoint of all, &#8216;oauth/access_token&#8217; (after all, how are we going to reward our users if we can&#8217;t access their accounts) and worked my way through a few other endpoints, including &#8216;users/self/media/recent/&#8217; which we use to search for photos taken with a location.</p>
<p>In the end, after about 12-14 hours and approximately 200 lines of code our implementation was complete. There were a few minor bugs that we worked through with the Instagram <span class="caps">API</span> developers regarding error codes being returned as part of the response as opposed to the <span class="caps">HTTP</span> Status and more useful error messages (should you run into rate limiting for example).</p>
<p>It wasn&#8217;t a particularly unpleasant experience; it would have been much more pleasant had faraday &gt; 0.4.6 been compatible with Rails 2!</p>
<p>If you&#8217;d like more details, or are experiencing some issues that you think we can help with, please <a href="mailto:tim@topguest.com">get in touch</a>.</p>
  </div>
</div>
		  </div>
		</div>
	</div>

	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
	<script>!window.jQuery && document.write(unescape('%3Cscript src="js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
	<script src="js/plugins.js"></script>
	<script src="js/script.js"></script>
</body>
</html>